# 差分数组
  一种高效执行 `区间修改` 的数据结构, 相比前缀和(Prefix Sum)适合用于 `区间查询`, 差分数则非常适用于 `频繁修改数组某个区间的值`  的场景。

1. 特性
   将一个区间加法操作转化为两个位置的修改，从而实现 `O(1)` 修改, 建议长度也为 `n + 1`

   - 定义
   ```text
   对于一个原始数组 `A{1..n]`, 我们构造一个差分数组 `D[1..n]`:
   D[1] = A[1]
   D[i] = A[i] - A[i - 1] ( i > 1)
   
   那么，我们可以通过差分数组还原原始数组的方式就是前缀和:
   A[i] = D[1] + D[2] + ... + D[i]
   ```
   
   - 为什么可以做到区间修改?
   差分数组可以在 `O(1)` 时间内把原数组某个区间 `[l, r]` 的值统一加个某个值 `x`:
   ```text
   D[l] += x
   D[r + 1] -= x (r + 1 <= n)
   
   这样我们还原回原数组时, 相当于 `[l, r]` 区间内的值都被加上 `x`
   ```

2. 时间复杂度
   - 单次区间修改: O(1)
   - 全部恢复成原数组: O(n)

3. 空间复杂度
   - O(1)
   
4. 应用场景
   - `频繁区间加法操作`，但不频繁查询单个元素的值
   - 处理多个区间操作的批量计算题
   - 算法竞赛常见场景
     - 交通流量分析(某路段某时间段加人)
     - 区间染色、区间温度变化、加热器影响范围等模拟类题目

5. 推导过程
   ```text
   A = [2, 3, 5, 7, 11]
   索引: 1, 2, 3, 4, 5
   
   1. 计算差分数组 D
   D[1] = A[1]        = 2
   D[2] = A[2] - A[1] = 3 - 2 = 1
   D[3] = A[3] - A[2] = 5 - 3 = 2
   D[4] = A[4] - A[3] = 7 - 5 = 2
   D[5] = A[5] - A[3] = 11 - 7 = 4
   
   所以: D = [2, 1, 2, 2, 4]
   
   2. 对区间 `[2, 4]` 的元素都加上 3
   A[2] = 3 + 3 = 6
   A[3] = 5 + 3 = 8
   A[4] = 7 + 3 = 10
   即新数组: 
   A' = [2, 6, 8, 10, 11]

   3. 重新计算差分数组 D
   D[1] = A[1]        = 2
   D[2] = A[2] - A[1] = 6 - 2 = 4
   D[3] = A[3] - A[2] = 8 - 6 = 2
   D[4] = A[4] - A[3] = 10 - 8 = 2
   D[5] = A[5] - A[3] = 11 - 10 = 1
   
   D = [2, 4, 2, 2, 1]
   
   4. 比较原来的 D  和现在的 D
   发现 D[2] 和 D [5] 发生变化
   D[2] = 4 - 1 = 3
   D[5] = 1 - 4 = -3
   
   5. 推导
   发现:
   D[2] += 3   ← 区间起点
   D[5] -= 3   ← 区间终点的后一位

   -> D[l] += 3
      D[r + 1] -= 3
   ```

6. 举例
   ```text
   A = [0, 0, 0, 0, 0]
   1. 将区间 `[1, 3]` 所有元素加上 `5`
   2. 将区间 `[2, 4]` 所有元素加上 `2`
   求最终数组的结果
   
   步骤:
   1. 初始化差分数组 `D`
   D = [0, 0, 0, 0, 0, 0] (长度为 n + 1)
   
   2. 区间 [1, 3] 加 5
      即: 下标 [0, 2] -> A[1], A[2], A[3]
   D[1] += 5 => D = [0, 5, 0, 0, 0, 0]
   D[4] -= 5 => D = [0, 5, 0, 0, -5, 0]
   
   注意 r + 1 = 3 + 1 = 4
   D = [0, 5, 0, 0, -5, 0]
   
   3. 区间 [2, 4] 加 2
      即: 下标 [1, 3] -> A[2], A[3], A[4]
   D[2] += 2 => D = [0, 5, 2, 0, -5, 0]
   D[5] -= 2 => D = [0, 5, 2, 0, -5, -2]
   
   D = [0, 5, 2, 0, -5, -2]
   
   4. 求前缀和还原数组 A
   A[0] = D[0]        = 0
   A[1] = D[1]        = 5
   A[2] = A[1] + D[2] = 5 + 2 = 7
   A[3] = A[2] + D[3] = 7 + 0 = 7
   A[4] = A[3] + D[4] = 7 + (-5) = 2
   
   最终:
   A = [0, 5, 7, 7, 2](下标从 0 开始)
   ```